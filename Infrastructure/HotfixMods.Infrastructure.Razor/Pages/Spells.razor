@using HotfixMods.Infrastructure.Razor.Pages.SpellTabs
@using HotfixMods.Infrastructure.Razor.Pages.Shared

@inject SpellService Service
@inherits HotfixPageBase<SpellDto>

@if (null == PageTab.Dto)
{
    <TabContentView Data="new List<DashboardModel>()" NewAsync_Callback="NewAsync_Click<SpellSearch_Dialog>" Title="Spells">
    </TabContentView>
}
else
{
    @*
    <TabContentEditHeader IsUpdate="false" Title="Spells" ValueCompare_Callback="@(async () => ValueCompareAsync_Click<SpellSearch_Dialog>())">
        <ChildContent>
            <MudTabPanel Class="custom-mud-tabs">
                <TabContent>
                    <TabTitle_Element Line1="HotfixMods" Line2="Entity" />
                </TabContent>
                <ChildContent>
                    <TabContentEditBody T="object">
                        <HotfixModsEntity_Tab Value="((SpellDto)PageTab.Dto).Entity" @bind-IsUpdate="((SpellDto)PageTab.Dto).IsUpdate" />
                    </TabContentEditBody>
                </ChildContent>
            </MudTabPanel>
            <MudTabPanel Class="custom-mud-tabs">
                <TabContent>
                    <TabTitle_Element Line1="Spell" />
                </TabContent>
                <ChildContent>
                    <TabContentEditBody T="object">
                        <Spell_Tab Value="((SpellDto)PageTab.Dto).Spell" />
                    </TabContentEditBody>
                </ChildContent>
            </MudTabPanel>
            <MudTabPanel Class="custom-mud-tabs">
                <TabContent>
                    <TabTitle_Element Line1="Spell" Line2="Name" />
                </TabContent>
                <ChildContent>
                    <TabContentEditBody T="object">
                        <SpellName_Tab Value="((SpellDto)PageTab.Dto).SpellName" />
                    </TabContentEditBody>
                </ChildContent>
            </MudTabPanel>
            <MudTabPanel Class="custom-mud-tabs">
                <TabContent>
                    <TabTitle_Element Line1="Spell" Line2="Power" />
                </TabContent>
                <ChildContent>
                    <TabContentEditBody T="object">
                        <SpellPower_Tab Value="((SpellDto)PageTab.Dto).SpellPower" />
                    </TabContentEditBody>
                </ChildContent>
            </MudTabPanel>
            <MudTabPanel Class="custom-mud-tabs">
                <TabContent>
                    <TabTitle_Element Line1="Spell" Line2="Cooldowns" />
                </TabContent>
                <ChildContent>
                    <TabContentEditBody T="object">
                        <SpellCooldowns_Tab Value="((SpellDto)PageTab.Dto).SpellCooldowns" />
                    </TabContentEditBody>
                </ChildContent>
            </MudTabPanel>
            <MudTabPanel Class="custom-mud-tabs">
                <TabContent>
                    <TabTitle_Element Line1="Spell" Line2="Misc" />
                </TabContent>
                <ChildContent>
                    <TabContentEditBody T="object" AmountOfPages="2" @bind-CurrentPage="currentSpellMiscPage">
                        <SpellMisc_Tab Value="((SpellDto)PageTab.Dto).SpellMisc" />
                    </TabContentEditBody>
                </ChildContent>
            </MudTabPanel>
            <MudTabPanel Class="custom-mud-tabs">
                <TabContent>
                    <TabTitle_Element Line1="Spell Aura" Line2="Options" />
                </TabContent>
                <ChildContent>
                    <TabContentEditBody T="object">
                        <SpellAuraOptions_Tab Value="((SpellDto)PageTab.Dto).SpellAuraOptions" />
                    </TabContentEditBody>
                </ChildContent>
            </MudTabPanel>
            <MudTabPanel Class="custom-mud-tabs">
                <TabContent>
                    <TabTitle_Element Line1="Spell" Line2="Effect" />
                </TabContent>
                <ChildContent>
                    @if (((SpellDto?)PageTab.Dto).EffectGroups.Any())
                    {
                        <TabContentEditBody T="SpellDto.EffectGroup" Instances="((SpellDto?)PageTab.Dto)?.EffectGroups" @bind-CurrentInstance="currentEffectInstance" AmountOfPages="3" @bind-CurrentPage="currentSpellEffectPage">

                            @foreach ((var effect, int index) in ((SpellDto?)PageTab.Dto).EffectGroups.WithIndex())
                            {
                                <SpellEffect_Tab Value="effect.SpellEffect" ValueCompare="@(PageTab.DtoCompare != null && ((SpellDto?)PageTab.DtoCompare)?.EffectGroups.Count > index ? ((SpellDto?)PageTab.DtoCompare)?.EffectGroups[index].SpellEffect : null)" />
                            }
                        </TabContentEditBody>
                    }
                    else
                    {
                        <TabContentEditBody T="SpellDto.EffectGroup" Instances="((SpellDto?)PageTab.Dto)?.EffectGroups" @bind-CurrentInstance="currentEffectInstance">
                            <TabContentNoData Text="There are no Spell Effects yet." />
                        </TabContentEditBody>
                    }
                </ChildContent>
            </MudTabPanel>
            <MudTabPanel Class="custom-mud-tabs">
                <TabContent>
                    <TabTitle_Element Line1="Spell X" Line2="Spell Visual" />
                </TabContent>
                <ChildContent>
                    <TabContentEditBody T="SpellDto.VisualGroup" Instances="((SpellDto?)PageTab.Dto)?.VisualGroups" @bind-CurrentInstance="currentVisualInstance">
                        @if (((SpellDto?)PageTab.Dto).VisualGroups.Any())
                        {
                            foreach ((var visual, int index) in ((SpellDto?)PageTab.Dto).VisualGroups.WithIndex())
                            {
                                <SpellXSpellVisual_Tab Value="visual.SpellXSpellVisual" ValueCompare="@(PageTab.DtoCompare != null && ((SpellDto?)PageTab.DtoCompare)?.VisualGroups.Count > index ? ((SpellDto?)PageTab.DtoCompare)?.VisualGroups[index].SpellXSpellVisual : null)" />
                            }
                        }
                        else
                        {
                            <TabContentNoData Text="There are no Spell Visuals yet." />
                        }
                    </TabContentEditBody>
                </ChildContent>
            </MudTabPanel>
            <MudTabPanel Class="custom-mud-tabs">
                <TabContent>
                    <TabTitle_Element Line1="Spell" Line2="Visual Event" />
                </TabContent>
                <ChildContent>
                    <TabContentEditBody T="SpellDto.VisualGroup" Instances="((SpellDto?)PageTab.Dto)?.VisualGroups" @bind-CurrentInstance="currentVisualInstance">
                        @if (((SpellDto?)PageTab.Dto).VisualGroups.Any())
                        {
                            foreach ((var visual, int index) in ((SpellDto?)PageTab.Dto).VisualGroups.WithIndex())
                            {
                                <SpellVisualEvent_Tab Value="visual.SpellVisualEvent" ValueCompare="@(PageTab.DtoCompare != null && ((SpellDto?)PageTab.DtoCompare)?.VisualGroups.Count > index ? ((SpellDto?)PageTab.DtoCompare)?.VisualGroups[index].SpellVisualEvent : null)" />
                            }
                        }
                        else
                        {
                            <TabContentNoData Text="There are no Spell Visuals yet." />
                        }
                    </TabContentEditBody>
                </ChildContent>
            </MudTabPanel>
            <MudTabPanel Class="custom-mud-tabs">
                <TabContent>
                    <TabTitle_Element Line1="Spell" Line2="Visual" />
                </TabContent>
                <ChildContent>

                    @if (((SpellDto?)PageTab.Dto).VisualGroups.Any())
                    {
                        <TabContentEditBody T="SpellDto.VisualGroup" Instances="((SpellDto?)PageTab.Dto)?.VisualGroups" @bind-CurrentInstance="currentVisualInstance" AmountOfPages="2" @bind-CurrentPage="@currentSpellVisualPage">
                            @foreach ((var visual, int index) in ((SpellDto?)PageTab.Dto).VisualGroups.WithIndex())
                            {
                                <SpellVisual_Tab Value="visual.SpellVisual" ValueCompare="@(PageTab.DtoCompare != null && ((SpellDto?)PageTab.DtoCompare)?.VisualGroups.Count > index ? ((SpellDto?)PageTab.DtoCompare)?.VisualGroups[index].SpellVisual : null)" />
                            }
                        </TabContentEditBody>
                    }
                    else
                    {
                        <TabContentEditBody T="SpellDto.VisualGroup" Instances="((SpellDto?)PageTab.Dto)?.VisualGroups" @bind-CurrentInstance="currentVisualInstance">
                            <TabContentNoData Text="There are no Spell Visuals yet." />
                        </TabContentEditBody>
                    }
                </ChildContent>
            </MudTabPanel>
        </ChildContent>
    </TabContentEditHeader>
    *@
}

@code {
    int currentSpellEffectPage = 1;
    int currentSpellMiscPage = 1;
    int currentSpellVisualPage = 1;

    int currentEffectInstance = 1;
    int currentVisualInstance = 1;

}