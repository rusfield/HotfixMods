<div style="@($"position:absolute; top:{(contentHeight / 2) - 60}px; left:calc(100%)")">
    <MudIconButton Icon="@Icons.Filled.NavigateNext" Color="Color.Primary" OnClick="@(async () => await NavigateSlide_EventCallback.InvokeAsync(CurrentSlide + 1))" Class="@("custom-slide-navigator" + (1 == type && CurrentSlide < AmountOfSlides ? "" : " invisible"))" />
</div>
<div style="@($"position:absolute; top:{(contentHeight / 2) - 60}px;left:-120px")">
    <MudIconButton Icon="@Icons.Filled.NavigateBefore" Color="Color.Primary" OnClick="@(async () => await NavigateSlide_EventCallback.InvokeAsync(CurrentSlide - 1))" Class="@("custom-slide-navigator " + (1 == type && CurrentSlide > 1 ? "" : " invisible"))" />
</div>
<MudPaper Height="@($"{contentHeight}px")" Class="mx-3 z-30 rounded-0" Style="@GetContentStyle()">
    <MudCarousel @ref="mudCarouselRef" TData="object" ShowBullets="false" AutoCycle="false" ShowArrows="false" Style="height:100%;">
        <div class="px-5 pb-5 pt-8">
            @ChildContent
        </div>
    </MudCarousel>
</MudPaper>


<MudPaper Class="mud-theme-primary d-flex flex-column align-center" Elevation="4" Style="height:48px;">
    @if (AddPage_EventCallback.HasDelegate && RemovePage_EventCallback.HasDelegate)
    {
        <MudStack Justify="Justify.SpaceBetween" Row="true" Style="width:100%">
            <MudStack Row="true" Class="invisible" Spacing="0">
                <MudIconButton Icon="@Icons.Filled.AddCircleOutline" />
                <MudIconButton Icon="@Icons.Filled.RemoveCircleOutline" />
            </MudStack>
            <MudPagination Selected="CurrentPage" SelectedChanged="NavigatePage_EventCallback" Size="Size.Medium" Count="AmountOfPages" Color="Color.Info" Class="@(AmountOfPages > 0 ? "" : "invisible")" />
            <MudStack Row="true" Spacing="0">
                <MudIconButton Icon="@Icons.Filled.RemoveCircleOutline" OnClick="@(async () => await RemovePageAsync())" Style="color:white;" Disabled="AmountOfPages <= 0" />
                <MudIconButton Icon="@Icons.Filled.AddCircleOutline" OnClick="@(async () => await AddPageAsync())" Style="color:white;" />
            </MudStack>
        </MudStack>
    }
</MudPaper>


@code {
    [Parameter]
    public RenderFragment? ChildContent { get; set; }

    [Parameter]
    public int AmountOfSlides { get; set; } = 1;

    [Parameter]
    public int AmountOfPages { get; set; } = 1;

    [Parameter]
    public int CurrentSlide { get; set; } = -1; //rename to Page

    [Parameter]
    public int CurrentPage { get; set; } = -1; // rename to Instance

    [Parameter]
    public EventCallback<int> CurrentSlideChanged { get; set; }

    [Parameter]
    public EventCallback<int> CurrentPageChanged { get; set; }

    [Parameter]
    public EventCallback<int> NavigatePage_EventCallback { get; set; }

    [Parameter]
    public EventCallback<int> NavigateSlide_EventCallback { get; set; }

    [Parameter]
    public EventCallback AddPage_EventCallback { get; set; }

    [Parameter]
    public EventCallback<int> RemovePage_EventCallback { get; set; }

    int contentHeight = 650;
    MudCarousel<object>? mudCarouselRef;
    int currentSlideIndex = 0;
    int type = 0; // 0 is normal, 1 is Page Navigation, 2 is Instance Navigation
    bool slideLeft = true;


    protected override void OnInitialized()
    {
        if (CurrentSlide > -1)
            type = 1;
        else if (CurrentPage > -1)
            type = 2;
        else
            type = 0;
        TransitionHandler.SetToNavigateTab();
        base.OnInitialized();
    }

    protected async override Task OnAfterRenderAsync(bool firstRender)
    {

        if (mudCarouselRef != null && mudCarouselRef.SelectedIndex != -1)
        {
            if (1 == type && currentSlideIndex != CurrentSlide - 1)
            {
                slideLeft = currentSlideIndex < CurrentSlide - 1;
                currentSlideIndex = CurrentSlide - 1;

                if (slideLeft)
                    TransitionHandler.SetToNavigateLeftBySlide();
                else
                    TransitionHandler.SetToNavigateRightBySlide();

                await InvokeAsync(() => mudCarouselRef.MoveTo(currentSlideIndex));
                this.StateHasChanged();
            }
            else if (2 == type && currentSlideIndex != CurrentPage - 1)
            {
                currentSlideIndex = CurrentPage - 1;

                TransitionHandler.SetToNavigateInstance();
                await InvokeAsync(() => mudCarouselRef.MoveTo(currentSlideIndex));
                this.StateHasChanged();
            }

        }

        if (mudCarouselRef != null && mudCarouselRef.SelectedIndex == currentSlideIndex)
            TransitionHandler.Reset();

        await base.OnAfterRenderAsync(firstRender);
    }

    async Task AddPageAsync()
    {
        await AddPage_EventCallback.InvokeAsync();
        CurrentPage = AmountOfPages;
    }

    async Task RemovePageAsync()
    {
        await RemovePage_EventCallback.InvokeAsync(CurrentPage);
    }

    string GetContentStyle()
    {
        // Add elevation value 2
        var elevation = "box-shadow:var(--mud-elevation-2)";

        if (1 == type && CurrentSlide < AmountOfSlides)
            elevation += ",2px 0px 2px 1px var(--mud-palette-primary)";
        else
            elevation += ",0px 0px 0px 0px var(--mud-palette-primary)";

        if (1 == type && CurrentSlide > 1)
            elevation += ",-2px 0px 2px 1px var(--mud-palette-primary)";
        else
            elevation += ",0px 0px 0px 0px var(--mud-palette-primary)";

        return $"background-color:var(--mud-palette-surface);{elevation};";
    }
}