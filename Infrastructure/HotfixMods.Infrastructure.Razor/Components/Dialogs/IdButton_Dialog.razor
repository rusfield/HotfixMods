@using Microsoft.JSInterop;
@using HotfixMods.Infrastructure.Services

@inject IJSRuntime JSRuntime
@inject ISnackbar Snackbar

<MudBadge Icon="@Icons.Material.Filled.Close" Color="Color.Primary" Overlap="true" OnClick="(() => Dialog.Cancel())" Style="cursor:pointer">
    <MudDialog>
        <DialogContent>
            <MudStack>
                <MudButton Color="Color.Primary" Variant="Variant.Filled" OnClick="CopyToClipboardAsync_Click">Copy Id</MudButton>
                <MudButton Color="Color.Primary" Variant="Variant.Filled" OnClick="RefreshAsync_Click" Disabled="@(!IsUpdate)">Refresh Id</MudButton>
            </MudStack>
        </DialogContent>
    </MudDialog>
</MudBadge>
@code {
    [CascadingParameter]
    MudDialogInstance Dialog { get; set; }

    [Parameter]
    public int Id { get; set; }

    [Parameter]
    public bool IsUpdate { get; set; }

    [Parameter]
    public Func<string, Task<int>> GetNextIdAsync { get; set; }

    [Parameter]
    public string TableName { get; set; }

    async Task CopyToClipboardAsync_Click()
    {
        await JSRuntime.InvokeVoidAsync("clipboardCopy.copyText", Id);
        Snackbar.Add($"{Id} copied to clipboard", Severity.Info, config => { config.Icon = Icons.Filled.Check; });
        Dialog.Close(-1);
    }

    async Task RefreshAsync_Click()
    {
        var newId = await GetNextIdAsync(TableName);

        if(-1 == newId)
        {
            Snackbar.Add($"TODO - No ID", Severity.Info, config => { config.Icon = Icons.Filled.Warning; });
        }
        else
        {
            Snackbar.Add($"ID set to {newId}", Severity.Info, config => { config.Icon = Icons.Filled.Check; });
            Dialog.Close(newId);
        }
    }
}