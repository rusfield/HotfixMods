@using HotfixMods.Infrastructure.DashboardModels

@typeparam T where T : IDashboardModel

<MudTable Items="@Data" Hover="true" @ref="@mudTableRef">
    <HeaderContent>
        <MudTh>@*Avatars*@</MudTh>
        <MudTh>NAME</MudTh>
        <MudTh>ID</MudTh>
        <MudTh Style="text-align:right">
            <MudButton Variant="Variant.Filled" Color="Color.Success" OnClick="Add">New</MudButton>
        </MudTh>
    </HeaderContent>
    <RowTemplate>
        <MudTd DataLabel="Avatar"><MudAvatar Elevation="6" Image="@($"{context.AvatarUrl}")" /></MudTd>
        <MudTd DataLabel="Name">@context.Name</MudTd>
        <MudTd DataLabel="Id">@context.Id</MudTd>
        <MudTd DataLabel="Action">
            <MudStack Row="true" Justify="Justify.FlexEnd">
                <MudIconButton Size="Size.Small" Color="Color.Info" Icon="@Icons.Material.Filled.Edit" Href="@($"/{context.Page}/{context.Id}")" />
                <MudIconButton Size="Size.Small" Color="Color.Error" Icon="@Icons.Material.Filled.Delete" OnClick="@(() => DeleteAsync(context))" />
            </MudStack>
        </MudTd>
    </RowTemplate>
    <PagerContent>
        <MudPaper Class="d-flex flex-column align-center">
            <MudPagination Rectangular="true" Variant="Variant.Text" Count="@((mudTableRef.GetFilteredItemsCount() + mudTableRef.RowsPerPage - 1) / mudTableRef.RowsPerPage)" Class="ma-2" SelectedChanged="PageChanged" />
        </MudPaper>
    </PagerContent>
</MudTable>



@code {
    [Parameter]
    public List<T> Data { get; set; }

    [Parameter]
    public Action Add { get; set; }

    MudTable<T> mudTableRef;


    async Task DeleteAsync(T entity)
    {
        await InvokeAsync(entity.DeleteAction);
        Data.RemoveAll(c => c.Id == entity.Id);
        this.StateHasChanged();
    }

    void PageChanged(int i)
    {
        mudTableRef.NavigateTo(i - 1);
    }
}
